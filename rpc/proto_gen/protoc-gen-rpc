#!/usr/bin/python

from descriptor_pb2 import *
from plugin_pb2 import *
import sys, os

def Log(s):
    f = open('log', 'a+')
    f.write('%s\n' % s)
    f.close()

Log('-------------start-------------')

s = sys.stdin.read()
Log('stdin %s bytes' % len(s))

gen_req = CodeGeneratorRequest()
gen_req.ParseFromString(s)
gen_rsp = CodeGeneratorResponse()

def Gen(filename, parameter):
    ori_filename = os.path.splitext(filename)[0]
    f = gen_rsp.file.add()
    f.name = ori_filename + '.rpc'
    f.content = 'This was generated by rpc.'
    #Log(dir(gen_rsp.file))

for filename in gen_req.file_to_generate:
    Gen(filename, gen_req.parameter)

output = gen_rsp.SerializeToString()
Log(output)
Log(dir(gen_rsp))
print gen_rsp.SerializeToString()
